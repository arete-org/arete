# ARETE Development Rules
# These guide both human contributors and AI tools (Cursor, Traycer)
# toward traceable, ethics-aligned, maintainable code.

## Code Quality
- Use the structured logger (`utils/logger.ts`) for all logs.
- Default to `async/await` for clarity, but use `.then()` or `Promise.all()` when parallelism or lazy chaining improves performance.
- Wrap risky operations in `try/catch` with informative error messages.
- Follow existing naming conventions for consistency.

## TypeScript Standards
- Use explicit types everywhere; avoid `any`.
- Use `interface` for public or extendable structures; use `type` for unions, aliases, or generics.
- Enable and honor strict null checks.
- Use generics thoughtfully when they clarify intent.

## ARETE Framework Principles
- Reuse existing utilities (`logger.ts`, `env.ts`, `pricing.ts`, `openaiService.ts`) before adding new modules.
- Every LLM interaction must record tokens and cost via `ChannelContextManager.recordLLMUsage()`.
- All buffers are RAM-only (no persistence to disk or database).
- Follow fail-open design: if uncertain, donâ€™t block execution.
- Log every decision at debug level with structured data.
- Keep all public interfaces serializable for future web UI integration (e.g., Cognitive Budget panel).

## ARETE Module Tagging
- Every module must include structured ARETE annotations in its JSDoc header.
- Use this format for consistency and machine-parseability:

```typescript
/**
 * @arete-module: <ModuleName>
 * @arete-risk: <critical|high|moderate|low>
 * @arete-ethics: <critical|high|moderate|low>
 * @arete-scope: <core|utility|interface|test>
 * 
 * @description
 * <1-3 lines summarizing what this module does.>
 * 
 * @impact
 * Risk: <What could break or be compromised if mishandled.>
 * Ethics: <What human or governance effect errors could cause.>
 */
```

- **@arete-risk**: Technical fragility (stability, security, data integrity)
- **@arete-ethics**: Human/governance impact (privacy, fairness, transparency, social harm)
- **@arete-scope**: Logical role in the system (helps auto-group modules)
- Run `pnpm validate-arete-tags` before committing; CI enforces this to guarantee standardized risk/ethics levels.
- Keep annotations under 10 lines for readability
- Separate technical risk from ethical sensitivity for clarity
- Enable future automated audit tools (e.g., `pnpm audit-risk`)

## ARETE Scoped Logger Tagging
- Every scoped logger must include structured ARETE annotations in its JSDoc header.
- Use this format for consistency and machine-parseability:

```typescript
/**
 * @arete-logger: <loggerName>
 * 
 * @logs
 * <What this scoped logger tracks and logs>
 * 
 * @impact
 * Risk: <Logging-specific risks if any>
 * Ethics: <Logging-specific ethical impacts if any>
 */
const <loggerName>Logger = logger.child({ module: '<loggerName>' });
```

- **@arete-logger**: Logger module identifier (matches the child logger name)
- **@logs**: What specific operations, events, or data this logger logs
- Follow the same formatting standards as module headers for consistency

## Code Changes
- Prefer small, well-scoped diffs.
- Preserve provenance comments, cost tracking, and licensing headers.
- Never remove risk annotations or audit metadata without explicit reason.
- Maintain backward compatibility unless explicitly breaking for a versioned release.

## Testing
- Add or update tests for any new functionality.
- Follow existing test utilities and patterns.
- Tests must be deterministic; mock external services where possible.
