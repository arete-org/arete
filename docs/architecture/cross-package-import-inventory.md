> Generated by Codex in Cursor, following `docs/ai/ai-direction-files.md`.  
> This report is evidence-based: every entry is derived from actual files in this repo (file path + exact import string). Any uncertainty is called out explicitly.

## 0) How this inventory was generated
I searched the repo for `@arete/` import strings in TypeScript and JavaScript source files, then reviewed each match to confirm it is inside an actual import or export statement.

Directories scanned:
- `packages/backend/src`
- `packages/discord-bot/src`
- `packages/web/src`
- `packages/backend/test` (expanded because a match was found in `packages/discord-bot/test/loggingPrivacy.test.ts`)
- `packages/discord-bot/test`

Quick presence check:
- `scripts/` (no `@arete/` imports found, so it is not part of the detailed inventory)

Excluded (hard): `node_modules/`, `dist/`, `build/`, `coverage/`, `.turbo/`, `.next/`, `.vite/`, `out/`, `tmp/`

File types included: `.ts`, `.tsx`, `.js`, `.jsx`, `.mts`, `.cts`

Import kind definitions used in this report:
- runtime (used when the program runs)
- type-only (TypeScript types; removed at runtime)
- dynamic (loaded at runtime via `import()`)
- require (CommonJS `require()`; none found)

No other alias-based cross-package patterns were found in the scanned files beyond `@arete/*`.

## 1) Executive summary (counts + hotspots)
Counts below are the number of import-string occurrences. If the same string appears multiple times in one file, each occurrence is counted.

Totals by package-to-package direction:
- `web -> backend`: 3 (type-only: 3)
- `discord-bot -> backend`: 14 (type-only: 11, runtime: 2, dynamic: 1)
- `web -> discord-bot`: 0
- `backend -> web`: 0
- `backend -> discord-bot`: 0

Totals by import kind (all directions):
- type-only: 14
- runtime: 2
- dynamic: 1
- require: 0

Top 5 files with the most cross-package imports:
- `packages/discord-bot/src/utils/env.ts` (5)
- `packages/discord-bot/src/utils/logger.ts` (2)
- `packages/discord-bot/src/types/arete-shared.d.ts` (1)
- `packages/discord-bot/src/utils/MessageProcessor.ts` (1)
- `packages/discord-bot/src/utils/prompting/Planner.ts` (1)

Top imported `@arete/*` strings across boundaries:
- `@arete/backend/ethics-core` (9)
- `@arete/backend/shared` (8)

## 2) Detailed inventory (by direction)

### `web -> backend`
- `packages/web/src/components/AskMeAnything.tsx` (web); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`
- `packages/web/src/components/MeetArete.tsx` (web); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`
- `packages/web/src/components/ProvenanceFooter.tsx` (web); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`, `RiskTier`, `Citation`

### `discord-bot -> backend`
- `packages/discord-bot/src/types/arete-shared.d.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`
- `packages/discord-bot/src/utils/MessageProcessor.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`
- `packages/discord-bot/src/utils/env.ts` (discord-bot); type-only; `@arete/backend/shared`; symbols: `PromptKey`
- `packages/discord-bot/src/utils/env.ts` (discord-bot); type-only; `@arete/backend/shared`; usage: `typeof import().PromptRegistry`
- `packages/discord-bot/src/utils/env.ts` (discord-bot); type-only; `@arete/backend/shared`; usage: `typeof import().renderPrompt`
- `packages/discord-bot/src/utils/env.ts` (discord-bot); type-only; `@arete/backend/shared`; usage: `typeof import().setActivePromptRegistry`
- `packages/discord-bot/src/utils/env.ts` (discord-bot); dynamic; `@arete/backend/shared`; usage: `await import()`
- `packages/discord-bot/src/utils/logger.ts` (discord-bot); runtime; `@arete/backend/shared`; symbols: `logger`, `formatUsd`, `logLLMCostSummary`, `sanitizeLogData`
- `packages/discord-bot/src/utils/logger.ts` (discord-bot); type-only; `@arete/backend/shared`; symbols: `LLMCostTotals`, `LLMCostSummaryProvider`
- `packages/discord-bot/src/utils/prompting/Planner.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `RiskTier`
- `packages/discord-bot/src/utils/response/metadata.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`, `RiskTier`, `Provenance`, `Citation`
- `packages/discord-bot/src/utils/response/provenanceFooter.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`, `RiskTier`, `Citation`
- `packages/discord-bot/src/utils/response/provenanceInteractions.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`, `Citation`
- `packages/discord-bot/test/loggingPrivacy.test.ts` (discord-bot test); runtime; `@arete/backend/shared`; symbols: `SqliteIncidentStore`

### `web -> discord-bot`
No matches found.

### `backend -> web`
No matches found.

### `backend -> discord-bot`
No matches found.

## 3) Remediation notes (suggestions, not prescriptions)
- The `@arete/backend/ethics-core` imports are all type-only and show up in both web and discord-bot. These look like shared data shapes (contract candidates) and might fit a dedicated contracts package or generated API types.
- Runtime coupling is limited to `@arete/backend/shared` usage in the discord-bot (logger re-export, prompt registry usage, and a test helper). A small shim or API client could reduce direct backend module dependency if that is a goal.
- Repeating patterns: `ResponseMetadata` and `RiskTier` types are used in multiple places; prompt registry and logging utilities are the most common runtime touchpoints.

## 4) Limitations / uncertainties
- Only `.ts`, `.tsx`, `.js`, `.jsx`, `.mts`, `.cts` files were scanned. Imports in other file types are not covered.
- `typeof import()` usages in `packages/discord-bot/src/utils/env.ts` were classified as type-only because they occur inside a type annotation block.

## 5) Sanity check
- Total `@arete/` matches found in scanned folders: 21
- Total cross-package matches reported: 17
- Notes on the difference:
  - `packages/backend/src/index.ts` has `@arete/backend/shared` in a comment (not an import).
  - `packages/discord-bot/src/types/arete-shared.d.ts` includes `@arete/backend/shared` in a doc comment and a `declare module` statement (not an import string inside `from`, `require`, or `import()`).
  - `packages/web/src/pages/InvitePage.tsx` includes `@arete/web` in a code snippet string (not an import).

## 6) Issue #146 snapshot (discord-bot ambient types removal)
This section focuses on the `discord-bot -> backend` references that are tied to `arete-shared.d.ts` and shared backend modules.

### `@arete/backend/shared` usage (discord-bot)
- `packages/discord-bot/src/utils/env.ts` (discord-bot); type-only; `@arete/backend/shared`; symbols: `PromptKey`
- `packages/discord-bot/src/utils/env.ts` (discord-bot); type-only; `@arete/backend/shared`; usage: `typeof import().PromptRegistry`
- `packages/discord-bot/src/utils/env.ts` (discord-bot); type-only; `@arete/backend/shared`; usage: `typeof import().renderPrompt`
- `packages/discord-bot/src/utils/env.ts` (discord-bot); type-only; `@arete/backend/shared`; usage: `typeof import().setActivePromptRegistry`
- `packages/discord-bot/src/utils/env.ts` (discord-bot); dynamic; `@arete/backend/shared`; usage: `await import()`
- `packages/discord-bot/src/utils/logger.ts` (discord-bot); runtime; `@arete/backend/shared`; symbols: `logger`, `formatUsd`, `logLLMCostSummary`, `sanitizeLogData`
- `packages/discord-bot/src/utils/logger.ts` (discord-bot); type-only; `@arete/backend/shared`; symbols: `LLMCostTotals`, `LLMCostSummaryProvider`
- `packages/discord-bot/test/loggingPrivacy.test.ts` (discord-bot test); runtime; `@arete/backend/shared`; symbols: `SqliteIncidentStore`

### `@arete/backend/ethics-core` usage (discord-bot)
- `packages/discord-bot/src/types/arete-shared.d.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`
- `packages/discord-bot/src/utils/MessageProcessor.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`
- `packages/discord-bot/src/utils/prompting/Planner.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `RiskTier`
- `packages/discord-bot/src/utils/response/metadata.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`, `RiskTier`, `Provenance`, `Citation`
- `packages/discord-bot/src/utils/response/provenanceFooter.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`, `RiskTier`, `Citation`
- `packages/discord-bot/src/utils/response/provenanceInteractions.ts` (discord-bot); type-only; `@arete/backend/ethics-core`; symbols: `ResponseMetadata`, `Citation`

## 7) Issue #146 planning notes (discord-bot decoupling)

### #146 Status / What remains
- Full coupling list is in Section 6; two buckets remain: type-only imports from `@arete/backend/ethics-core` and runtime imports from `@arete/backend/shared`.
- Goal: move bot types to `@arete/contracts/ethics-core` and remove runtime imports of backend internals.
- Highest-risk runtime couplings: prompt registry import (`packages/discord-bot/src/utils/env.ts`) and logger re-export (`packages/discord-bot/src/utils/logger.ts`).

### Decision record (current direction)
- Types: use `@arete/contracts/ethics-core` (contracts package exists under `packages/contracts`).
- Prompts: access via backend API with auth required by default (prompt registry remains backend-owned (existing YAML-based registry)).
- Logging: keep local for now; later centralize via Docker/Compose aggregation (no API logging work in #146).
- Backend down: disable AI responses and return a clear fallback message/menu (planned behavior; not implemented yet).

### Prompt access plan (impacted call sites + minimal response)
All prompt call sites use the same pattern: `renderPrompt("<key>", {...})`.
Files + functions that call it today:
- `packages/discord-bot/src/commands/news.ts`: `newsCommand.execute`
- `packages/discord-bot/src/commands/image/openai.ts`: `generateImageWithMetadata`
- `packages/discord-bot/src/commands/image/prompts.ts`: `buildDeveloperPrompt`
- `packages/discord-bot/src/utils/openaiService.ts`: `OpenAIService.reduceContext`
- `packages/discord-bot/src/utils/prompting/RealtimeContextBuilder.ts`: `RealtimeContextBuilder.buildContext`
- `packages/discord-bot/src/utils/prompting/ContextBuilder.ts`: `ContextBuilder.buildContext`
- `packages/discord-bot/src/utils/prompting/Planner.ts`: `Planner.generatePlan`
- `packages/discord-bot/src/utils/response/provenanceInteractions.ts`: `generateAlternativeLensMessage`, `generateExplanationMessage`, `requestProvenanceOpenAIOptions`

Minimal API response shape the bot needs today:
- Required now: `{ "content": "string" }`

Auth scheme for prompt requests (mirrors trace token pattern in backend trace handler):
- Env: `PROMPT_API_TOKEN` (to be added)
- Header: `x-arete-prompt-token`
- Enforcement: new backend prompt handler should gate access before reading prompt registry

Fallback behavior expectation:
- If the backend is down or prompt fetch fails, AI responses are disabled and the bot returns a clear fallback message/menu.
- The cleanest place to gate this is the message pipeline in `packages/discord-bot/src/utils/MessageProcessor.ts`, before any planner/OpenAI calls.

### Next steps (incremental)
- Add an authenticated backend prompt endpoint (serve prompt content only). The backend does not have a prompt handler today.
- Update the bot to fetch prompts via the API and disable AI responses when prompts are unavailable.
- Migrate bot types from `@arete/backend/ethics-core` to `@arete/contracts/ethics-core`.
- Remove `packages/discord-bot/src/types/arete-shared.d.ts` and drop the `@arete/backend` dependency once no usages remain.
- Move `packages/discord-bot/test/loggingPrivacy.test.ts` into backend tests to remove test-only coupling.
